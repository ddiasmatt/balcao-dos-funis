version: '3.8'

networks:
  traefik-public:
    external: true

services:
  balcao-dos-funis:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: balcao-dos-funis-dev
    restart: unless-stopped
    ports:
      - "3000:80"  # Para desenvolvimento local sem Traefik
    networks:
      - traefik-public
    environment:
      - NODE_ENV=development
    labels:
      # Enable Traefik para desenvolvimento local
      - "traefik.enable=true"
      - "traefik.docker.network=traefik-public"

      # Unified router for local development
      - "traefik.http.routers.balcao-dev.rule=Host(`balcao.localhost`) || Host(`localhost`)"
      - "traefik.http.routers.balcao-dev.entrypoints=web"
      - "traefik.http.services.balcao-dev.loadbalancer.server.port=80"

      # Simple compression for dev
      - "traefik.http.middlewares.balcao-dev-compress.compress=true"
      - "traefik.http.routers.balcao-dev.middlewares=balcao-dev-compress"
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost/"]
      interval: 30s
      timeout: 10s
      retries: 3